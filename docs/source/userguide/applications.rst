.. _applications:

==============================
Applications for each 3D steps
==============================

Grid generation
***************

Description
^^^^^^^^^^^

From sensors image, compute the stereo-rectification grids

Configuration
^^^^^^^^^^^^^

+-----------------+-----------------------------------------------+---------+---------------+----------+
| Name            | Description                                   | Type    | Default value | Required |
+=================+===============================================+=========+===============+==========+
| method          | Method for grid generation                    | string  | epipolar      | Yes      |
+-----------------+-----------------------------------------------+---------+---------------+----------+
| epi_step        | Step of the deformation grid in nb. of pixels | int     | 30            | No       |
+-----------------+-----------------------------------------------+---------+---------------+----------+
| save_grids      | Save the generated grids in output folder     | boolean | False         | No       |
+-----------------+-----------------------------------------------+---------+---------------+----------+
| geometry_loader | Geometry external library                     | string  | "otb"         | No       |
+-----------------+-----------------------------------------------+---------+---------------+----------+

Resampling
**********

Description
^^^^^^^^^^^

Input images are resampled with grids.


Configuration
^^^^^^^^^^^^^

+---------------------+--------------------------------------------------------+---------+---------------+----------+
| Name                | Description                                            | Type    | Default value | Required |
+=====================+========================================================+=========+===============+==========+
| method              | Method for resampling                                  | string  | bicubic       | Yes      |
+---------------------+--------------------------------------------------------+---------+---------------+----------+
| epi_tile_size       | size in pixels of tile                                 | int     | 500           | No       |
+---------------------+--------------------------------------------------------+---------+---------------+----------+
| save_epipolar_image | Save the generated images in output folder             | boolean | False         | No       |
+---------------------+--------------------------------------------------------+---------+---------------+----------+
| save_epipolar_color | Save the generated images (only if color is avalaible) | boolean | False         | No       |
+---------------------+--------------------------------------------------------+---------+---------------+----------+

Sparse matching
***************

Description
^^^^^^^^^^^

Compute keypoints matches on pair images

Configuration
^^^^^^^^^^^^^

+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| Name                                 | Description                                                                                 | Type       | avalaible value | Default value | Required |
+======================================+=============================================================================================+============+=================+===============+==========+
| method                               | Method for sparse matching                                                                  | string     | "sift"          | "sift"        | Yes      |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| disparity_margin                     | Add a margin to min and max disparity as percent of the disparity range.                    | float      |                 | 0.02          | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| elevation_delta_lower_bound          | Expected lower bound for elevation delta with respect to input low resolution DTM in meters | int, float |                 | -1000         | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| elevation_delta_upper_bound          | Expected upper bound for elevation delta with respect to input low resolution DTM in meters | int, float |                 | 1000          | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| epipolar_error_upper_bound           | Expected upper bound for epipolar error in pixels                                           | float      |                 | 10.0          | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| epipolar_error_maximum_bias          | Maximum bias for epipolar error in pixels                                                   | float      |                 | 0.0           | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| disparity_outliers_rejection_percent |                                                                                             | float      |                 | 0.1           | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| sift_matching_threshold              |                                                                                             | float      |                 | 0.6           | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| sift_n_octave                        |                                                                                             | int        |                 | 8             | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| sift_n_scale_per_octave              |                                                                                             | int        |                 | 3             | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| sift_dog_threshold                   |                                                                                             | float      |                 | 20.0          | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| sift_edge_threshold                  |                                                                                             | float      |                 | -5.0          | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| sift_magnification                   |                                                                                             | float      |                 | 2.0           | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| sift_back_matching                   |                                                                                             | Boolean    |                 | True          | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+
| save_matches                         | Save matches                                                                                | Boolean    |                 | False         | No       |
+--------------------------------------+---------------------------------------------------------------------------------------------+------------+-----------------+---------------+----------+

Dense matching
**************

Description
^^^^^^^^^^^

Compute disparity map from stereo-rectified pair images

Configuration
^^^^^^^^^^^^^

+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| Name                            | Description                                                             | Type    | avalaible value                 | Default value | Required |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| method                          | Method for dense matching                                               | string  | all method avalaible on Pandora | "census_sgm"  | Yes      |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| loader                          | external library use to compute dense matching                          | string  | "pandora"                       | "pandora"     | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| loader_conf                     | Configuration associated with loader                                    | dict    |                                 |               | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| min_elevation_offset            | Override minimum disparity from prepare step with this offset in meters | int     |                                 | None          | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| max_elevation_offset            | Override maximum disparity from prepare step with this offset in meters | int     |                                 | None          | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| use_sec_disp                    | Compute secondary disparity map                                         | boolean |                                 | False         | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| min_epi_tile_size               |                                                                         | int     |                                 | 300           | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| max_epi_tile_size               |                                                                         | int     |                                 | 300           | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| epipolar_tile_margin_in_percent |                                                                         | int     |                                 | 60            | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+
| save_disparity_map              | Save disparity map                                                      | boolean |                                 | False         | No       |
+---------------------------------+-------------------------------------------------------------------------+---------+---------------------------------+---------------+----------+

Triangulation
*************

Description
^^^^^^^^^^^

Triangulating the sights and get for each point of the reference image a latitude, longitude, altitude poin

Configuration
^^^^^^^^^^^^^
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------------------------------+------------------------------+----------+
| Name              | Description                                                                                                                                                               | Type    | avalaible value              | Default value                | Required |
+===================+===========================================================================================================================================================================+=========+==============================+==============================+==========+
| method            | Method for triangulation                                                                                                                                                  | string  | "line_of_sight_intersection" | "line_of_sight_intersection" | Yes      |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------------------------------+------------------------------+----------+
| geometry_loader   | Geometry external library                                                                                                                                                 | string  | "otb"                        | "otb"                        | No       |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------------------------------+------------------------------+----------+
| use_geoid_alt     | Use geoid grid as altimetric reference.                                                                                                                                   | boolean |                              | False                        | No       |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------------------------------+------------------------------+----------+
| snap_to_img1      | This mode can be used if all pairs share the same left image. It will then modify lines of sights of secondary images so that they all cross those of the reference image | boolean |                              | False                        | No       |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------------------------------+------------------------------+----------+
| add_msk_info      |                                                                                                                                                                           | boolean |                              | True                         | No       |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------------------------------+------------------------------+----------+
| save_points_cloud | save points_cloud                                                                                                                                                         | boolean |                              | False                        | No       |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------------------------------+------------------------------+----------+


Point Cloud fusion
******************

Description
^^^^^^^^^^^

Merge points clouds coming from each pair

Configuration
^^^^^^^^^^^^^

+-------------------+-----------------------+---------+----------------------------+----------------------------+----------+
| Name              | Description           | Type    | avalaible value            | Default value              | Required |
+===================+=======================+=========+============================+============================+==========+
| method            | Method for fusion     | string  | "mapping_to_terrain_tiles" | "mapping_to_terrain_tiles" | Yes      |
+-------------------+-----------------------+---------+----------------------------+----------------------------+----------+
| resolution        | Resolution of the dsm | float   | should be > 0              | 0.5                        | No       |
+-------------------+-----------------------+---------+----------------------------+----------------------------+----------+
| terrain_tile_size |                       | int     |                            | None                       | No       |
+-------------------+-----------------------+---------+----------------------------+----------------------------+----------+
| save_points_cloud | Save points clouds    | boolean |                            | False                      | No       |
+-------------------+-----------------------+---------+----------------------------+----------------------------+----------+


Point Cloud outliers removing
*****************************

Description
^^^^^^^^^^^

Point cloud outliers removing


Configuration
^^^^^^^^^^^^^

+-------------------+------------------------------------------+---------+-----------------------------------+---------------+----------+
| Name              | Description                              | Type    | avalaible value                   | Default value | Required |
+===================+==========================================+=========+===================================+===============+==========+
| method            | Method for point cloud outliers removing | string  | "statistical", "small_components" | "statistical" | Yes      |
+-------------------+------------------------------------------+---------+-----------------------------------+---------------+----------+
| save_points_cloud | Save points clouds                       | boolean |                                   | False         | No       |
+-------------------+------------------------------------------+---------+-----------------------------------+---------------+----------+

If method is *statistical*:

+----------------+-------------+---------+-----------------+---------------+----------+
| Name           | Description | Type    | avalaible value | Default value | Required |
+================+=============+=========+=================+===============+==========+
| activated      |             | boolean |                 | True          | No       |
+----------------+-------------+---------+-----------------+---------------+----------+
| k              |             | int     | should be > 0   | 50            | No       |
+----------------+-------------+---------+-----------------+---------------+----------+
| std_dev_factor |             | float   |                 | 5.0           | No       |
+----------------+-------------+---------+-----------------+---------------+----------+

If method is *small_components*

+-----------------------------+-------------+---------+-----------------+---------------+----------+
| Name                        | Description | Type    | avalaible value | Default value | Required |
+=============================+=============+=========+=================+===============+==========+
| activated                   |             | boolean |                 | True          | No       |
+-----------------------------+-------------+---------+-----------------+---------------+----------+
| on_ground_margin            |             | int     |                 | 10            | No       |
+-----------------------------+-------------+---------+-----------------+---------------+----------+
| connection_distance         |             | float   |                 | 3.0           | No       |
+-----------------------------+-------------+---------+-----------------+---------------+----------+
| nb_points_threshold         |             | int     |                 | 50            | No       |
+-----------------------------+-------------+---------+-----------------+---------------+----------+
| clusters_distance_threshold |             | float   |                 | None          | No       |
+-----------------------------+-------------+---------+-----------------+---------------+----------+


Rasterization
*************

Description
^^^^^^^^^^^

Project altitudes on regular grid

Configuration
^^^^^^^^^^^^^
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| Name                        | Description            | Type       | avalaible value | Default value   | Required |
+=============================+========================+============+=================+=================+==========+
| method                      |                        | string     | simple_gaussian | simple_gaussian | Yes      |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| dsm_radius                  |                        | float, int |                 | 1.0             | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| sigma                       |                        | float      |                 | None            | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| grid_points_division_factor |                        | int        |                 | None            | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| resolution                  |                        | float      |                 | 0.5             | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| dsm_no_data                 |                        | int        |                 | - 32768         |          |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| color_no_data               |                        | int        |                 | 0               |          |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| color_dtype                 |                        | string     |                 | "uint16"        |          |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| msk_no_data                 |                        | int        |                 | 65535           |          |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| write_color                 | Save color ortho-image | boolean    |                 | False           | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| write_stats                 |                        | boolean    |                 | False           | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| write_msk                   |                        | boolean    |                 | False           | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+
| write_dsm                   | Save dsm               | boolean    |                 | True            | No       |
+-----------------------------+------------------------+------------+-----------------+-----------------+----------+


