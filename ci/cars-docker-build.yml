spec:
  inputs:
    tag:
---

variables:
  CARS_ENV_IMAGE_NAME: "${CARS_DOCKER_REGISTRY}/cars-deps-env"
  CARS_ENV_IMAGE_TAG: "$[[ inputs.tag ]]"

# Build cars env
cars-dep-env-build:
  extends:
    - .podman-build
  variables:
    # CARS environment image configuration
    DOCKERFILE: "ci/cars-deps-env/Dockerfile"
    #CARS_ENV_IMAGE_TAG: "latest"
    CARS_ENV_DOCKERFILE: "${CI_PROJECT_DIR}/${DOCKERFILE}"
    # docker generation
    ENV_IMAGE_NAME: "${CARS_ENV_IMAGE_NAME}"
    ENV_IMAGE_TAG: "${CARS_ENV_IMAGE_TAG}"
    ENV_DOCKERFILE: "${CARS_ENV_DOCKERFILE}"
    DOCKER_BUILD_OPTIONS: "--build-arg PIP_INDEX_URL=${PIP_INDEX_URL} --build-arg BASE_IMAGE=${PYTHON_IMAGE}"

# Set variables for templated hadolint build
hadolint_dep-env:
  extends:
    - .hadolint
  variables:
    # CARS environment image configuration
    DOCKERFILE: "ci/cars-deps-env/Dockerfile"
    #CARS_ENV_IMAGE_TAG: "latest"
    CARS_ENV_DOCKERFILE: "${CI_PROJECT_DIR}/${DOCKERFILE}"
    HADOLINT_CONFIG_FILE: ci/hadolint_RNC_A_B_C_D.yaml
    ENV_DOCKERFILE: "${CI_PROJECT_DIR}/${DOCKERFILE}"
  allow_failure: true